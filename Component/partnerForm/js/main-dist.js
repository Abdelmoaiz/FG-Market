const{ipcRenderer:ipcRenderer}=require("electron");let dateNow,date=new Date;dateNow=date.getMonth()+1<10&&date.getDate()<10?`${date.getFullYear()}-0${date.getMonth()+1}-0${date.getDate()}`:date.getMonth()+1<10&&date.getDate()>10?`${date.getFullYear()}-0${date.getMonth()+1}-${date.getDate()}`:date.getMonth()+1>10&&date.getDate()<10?`${date.getFullYear()}-${date.getMonth()+1}-0${date.getDate()}`:`${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;let userName=document.querySelector(".userName"),dateAndTime=document.querySelector(".dateAndTime");userName.innerHTML=localStorage.getItem("userNameView"),dateAndTime.innerHTML=dateNow;let tmp,users,mood="create";function openInputsAdd(){document.querySelector(".addEmployee").style.display="block",document.querySelector(".inputs").style.display="none"}users=null!=localStorage.allUsers?JSON.parse(localStorage.allUsers):[];let tmpPartner,idPartner,totalGainSup=0,totalPrice=0,total=0,totalCommission=0,totalNowlon=0,totalFarkPrice=0,totalPaid=0,suppliers=[],namePartner=document.querySelector("#namePartner"),idPersonalPartner=document.querySelector("#idPersonalPartner"),phonePartner=document.querySelector("#phonePartner"),adress=document.querySelector("#adress"),title=document.querySelector("#title"),price=document.querySelector("#price"),paidPrice=document.querySelector("#paidPrice"),remainPrice=document.querySelector("#remainPrice"),moodPartner="create",partner=[];function getId(){if(0!=partner[partner.length-1].length)for(let e=0;e<partner[partner.length-1].length;e++)for(let t=0;t<partner[partner.length-1][e].myPartner.length;t++)idPartner=e+1;else idPartner=1}function addPartnerNew(){document.querySelector(".addPartner").style.display="block",getId(),console.log(idPartner)}let tmpId,tmpIdDelete,tablePartner,createPartner=document.querySelector(".createPartner"),customer=[];function addPrice(e){document.querySelector(".addPartner").style.display="block",document.querySelector(".priceOnly").style.display="none",document.querySelector(".addPricePartner").style.display="flex";for(let t=0;t<partner[partner.length-1].length;t++)for(let r=0;r<partner[partner.length-1][t].myPartner.length;r++)if(partner[partner.length-1][t]._id==e){let n=partner[partner.length-1][t].myPartner;namePartner.value=n[r].namePartner,idPersonalPartner.value=n[r].idPersonalPartner,phonePartner.value=n[r].phonePartner,adress.value=n[r].adress,mood="add",namePartner.focus(),scroll({top:0,behavior:"smooth"}),document.querySelector(".createPartner").innerHTML="اضافة",tmpId=e,tmp=t}}function updatePartner(e){document.querySelector(".addPartner").style.display="block";for(let t=0;t<partner[partner.length-1].length;t++)for(let r=0;r<partner[partner.length-1][t].myPartner.length;r++)if(partner[partner.length-1][t]._id==e){let n=partner[partner.length-1][t].myPartner;console.log(n),namePartner.value=n[r].namePartner,idPersonalPartner.value=n[r].idPersonalPartner,phonePartner.value=n[r].phonePartner,adress.value=n[r].adress,mood="update",console.log(mood),namePartner.focus(),scroll({top:0,behavior:"smooth"}),document.querySelector(".createPartner").innerHTML="تحديث",tmpId=e,tmp=t}}function deletPartner(e){if("عبدالمعز"==userName.innerHTML)document.querySelector(".alarm").style.display="block",tmpIdDelete=e;else for(let t=0;t<users.length;t++)userName.innerHTML!=users[t].user||"it"!=users[t].job&&"مدير"!=users[t].job||(document.querySelector(".alarm").style.display="block",tmpIdDelete=e)}function checkPass(){ipcRenderer.send("delete-Partner",tmpIdDelete),window.location.reload(),showDetailsPartner()}function exitePass(){window.location.reload()}createPartner.addEventListener("click",(e=>{let t="";if(""!=namePartner.value)if(t={idPartner:idPartner,user:userName.innerHTML,date:dateNow,namePartner:namePartner.value,idPersonalPartner:idPersonalPartner.value,phonePartner:phonePartner.value,adress:adress.value,title:title.value,price:price.value,paidPrice:paidPrice.value,remainPrice:remainPrice.value},"create"==mood)customer.push(t),ipcRenderer.send("myPartner",customer),window.location.reload();else if("update"==mood)ipcRenderer.send("update-Partner",{...t,tmpId:tmpId}),window.location.reload();else if("add"==mood){partner[partner.length-1][tmp].myPartner.push(t);let e=partner[partner.length-1][tmp];ipcRenderer.send("update-Partner",{...e,tmpId:tmpId}),window.location.reload()}showDetailsPartner()}));let z,totalPricePartner=0,totalPaidPartner=0,totalRemainPartner=0,totalCapital=0,totalGain=0;function showDetailsPartner(){ipcRenderer.send("get-invoiceSup","bing"),ipcRenderer.on("get-invoiceSup",((e,t)=>{const r=JSON.parse(t);suppliers.push(r)})),ipcRenderer.send("get-invoiceSup","bing"),ipcRenderer.on("get-invoiceSup",((e,t)=>{const r=JSON.parse(t);suppliers.push(r);for(let e=0;e<suppliers[suppliers.length-1].length;e++){let t=suppliers[suppliers.length-1];for(let r=0;r<suppliers[suppliers.length-1][e].newInvoiceBuy.length;r++)totalFarkPrice=+t[e].newInvoiceBuy[r].totalPrice-+t[e].newInvoiceBuy[r].total,totalNowlon=+t[e].newInvoiceBuy[r].nowlone,totalCommission=(+t[e].newInvoiceBuy[r].total-totalNowlon)*+t[e].newInvoiceBuy[r].commission,totalGain+=50}})),tablePartner="",ipcRenderer.send("get-Partner","bing"),ipcRenderer.on("get-Partner",((e,t)=>{const r=JSON.parse(t);partner.push(r),tablePartner="";for(let e=0;e<partner[partner.length-1].length;e++){let t=partner[partner.length-1];for(let r=0;r<t[e].myPartner.length;r++)totalCapital+=+t[e].myPartner[r].paidPrice;tablePartner+=`\n                <tr>\n                    <td>${t[e].myPartner[0].date}</td>\n                    <td>${t[e].myPartner[0].user}</td>\n                    <td>${t[e].myPartner[0].namePartner}</td>\n                    <td>${t[e].myPartner[0].idPersonalPartner}</td>\n                    <td>${t[e].myPartner[0].phonePartner}</td>\n                    <td>${t[e].myPartner[0].adress}</td>\n                    <td><button onclick="detailsPartner('${t[e]._id}');">عرض</button></td>\n                    <td><button onclick="addPrice('${t[e]._id}');">اضافة</button></td>\n                    <td><button onclick="updatePartner('${t[e]._id}');">تعديل</button></td>\n                    <td><button onclick="deletPartner('${t[e]._id}');">حذف</button></td>\n    \n                </tr>\n                `}document.querySelector(".tbodyPartner").innerHTML=tablePartner,totalCapital=0}))}setTimeout((()=>{ipcRenderer.send("get-invoiceSup","bing"),ipcRenderer.on("get-invoiceSup",((e,t)=>{const r=JSON.parse(t);suppliers.push(r);for(let e=0;e<suppliers[suppliers.length-1].length;e++){let t=suppliers[suppliers.length-1];for(let r=0;r<suppliers[suppliers.length-1][e].newInvoiceBuy.length;r++)totalFarkPrice=+t[e].newInvoiceBuy[r].totalPrice-+t[e].newInvoiceBuy[r].total,totalNowlon=+t[e].newInvoiceBuy[r].nowlone,totalCommission=(+t[e].newInvoiceBuy[r].total-totalNowlon)*+t[e].newInvoiceBuy[r].commission,totalGain+=50}})),tablePartner="",ipcRenderer.send("get-Partner","bing"),ipcRenderer.on("get-Partner",((e,t)=>{const r=JSON.parse(t);partner.push(r),tablePartner="";for(let e=0;e<partner[partner.length-1].length;e++){let t=partner[partner.length-1];for(let r=0;r<t[e].myPartner.length;r++)totalCapital+=+t[e].myPartner[r].paidPrice;tablePartner+=`\n                <tr>\n                    <td>${t[e].myPartner[0].date}</td>\n                    <td>${t[e].myPartner[0].user}</td>\n                    <td>${t[e].myPartner[0].namePartner}</td>\n                    <td>${t[e].myPartner[0].idPersonalPartner}</td>\n                    <td>${t[e].myPartner[0].phonePartner}</td>\n                    <td>${t[e].myPartner[0].adress}</td>\n                    <td><button onclick="detailsPartner('${t[e]._id}');">عرض</button></td>\n                    <td><button onclick="addPrice('${t[e]._id}');">اضافة</button></td>\n                    <td><button onclick="updatePartner('${t[e]._id}');">تعديل</button></td>\n                    <td><button onclick="deletPartner('${t[e]._id}');">حذف</button></td>\n    \n                </tr>\n                `}document.querySelector(".tbodyPartner").innerHTML=tablePartner,totalCapital=0}))}),10),showDetailsPartner();let tableDetailsPartner,mydataPro=[];function getPurchases(){ipcRenderer.send("get-Data","bing"),ipcRenderer.on("get-Data",((e,t)=>{const r=JSON.parse(t);mydataPro.push(r)}))}function detailsPartner(e){document.querySelector(".tableAllPartner").style.display="none",document.querySelector(".detailsPartner").style.display="block",showDetailsPartner(),getPurchases(),tableDetailsPartner="";for(let t=0;t<partner[partner.length-1].length;t++)for(let r=0;r<partner[partner.length-1][t].myPartner.length;r++)if(e==partner[partner.length-1][t]._id){let e=partner[partner.length-1];totalPricePartner+=+e[t].myPartner[r].price,totalPaidPartner+=+e[t].myPartner[r].paidPrice,totalRemainPartner=+totalPricePartner-+totalPaidPartner,document.querySelector(".headTable").innerHTML=`${e[t].myPartner[0].namePartner}`,tableDetailsPartner+=`\n                <tr>\n                    <td>${e[t].myPartner[r].date}</td>\n                    <td>${e[t].myPartner[0].namePartner}</td>\n                    <td>${e[t].myPartner[r].title}</td>\n                    <td>${+e[t].myPartner[r].price}</td>\n                    <td>${e[t].myPartner[r].paidPrice}</td>\n                    <td>${+e[t].myPartner[r].price-+e[t].myPartner[r].paidPrice}</td>\n                    \n                </tr>\n                `}tableDetailsPartner+=`\n        <tr>\n            <td colspan='3'>الاجمالي</td>\n            <td>${totalPricePartner}</td>\n            <td>${totalPaidPartner}</td>\n            <td class='remainMakeUp'>${totalRemainPartner}</td>\n            <td colspan='3'></td>\n        </tr>\n            `,document.querySelector(".tbodyDetailsPartner").innerHTML=tableDetailsPartner,totalPricePartner=0,totalPaidPartner=0,totalRemainPartner=0}function returnBack(){document.querySelector(".tableAllPartner").style.display="block",document.querySelector(".detailsPartner").style.display="none"}function colorRemainPartner(){let e=document.querySelectorAll(".remainPartner");for(let t=0;t<e.length;t++)e[t].innerHTML<0?e[t].style.color="red":e[t].innerHTML>0&&(e[t].style.color="green")}function printPage(){document.querySelector(".addPartner").style.display="none",document.querySelector(".searchPartner").style.display="none",document.querySelector("aside").style.display="none",document.querySelector("header").style.display="none",document.querySelector(".content").style.width="100%",window.print(),window.location.reload()}getPurchases(),colorRemainPartner(),document.querySelector(".viewSearchPartner").onclick=function(){document.querySelector(".addSuppliers").style.display="none",document.querySelector(".searchSuppliers").style.display="block"},document.querySelector(".viewAddPartner").onclick=function(){document.querySelector(".addPartner").style.display="block",document.querySelector(".searchPartner").style.display="none"};let wordSearchSuppliers=document.querySelector("#wordSearchPartner");function refresh(){window.location.reload()}