const{ipcRenderer:ipcRenderer}=require("electron");let dateNow,date=new Date;dateNow=date.getMonth()+1<10&&date.getDate()<10?`${date.getFullYear()}-0${date.getMonth()+1}-0${date.getDate()}`:date.getMonth()+1<10&&date.getDate()>10?`${date.getFullYear()}-0${date.getMonth()+1}-${date.getDate()}`:date.getMonth()+1>10&&date.getDate()<10?`${date.getFullYear()}-${date.getMonth()+1}-0${date.getDate()}`:`${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;let userName=document.querySelector(".userName"),dateAndTime=document.querySelector(".dateAndTime");userName.innerHTML=localStorage.getItem("userNameView"),dateAndTime.innerHTML=dateNow;let tmp,users,mood="create";function openInputsAdd(){document.querySelector(".addEmployee").style.display="block",document.querySelector(".inputs").style.display="none"}users=null!=localStorage.allUsers?JSON.parse(localStorage.allUsers):[];let tmpSuppliers,nameSuppliers=document.querySelector("#nameSuppliers"),idPersonalSuppliers=document.querySelector("#idPersonalSuppliers"),phoneSuppliers=document.querySelector("#phoneSuppliers"),adress=document.querySelector("#adress"),moodSuppliers="create",suppliers=[];function addSuplaierNew(){document.querySelector(".addSuppliers").style.display="block"}let tmpIdDelete,tableSuppliers,createSuppliers=document.querySelector(".createSuppliers");function updateSuppliers(e){document.querySelector(".addSuppliers").style.display="block";for(let t=0;t<suppliers[suppliers.length-1].length;t++)if(suppliers[suppliers.length-1][t]._id==e){let l=suppliers[suppliers.length-1][t].mySuppliers;nameSuppliers.value=l.nameSuppliers,idPersonalSuppliers.value=l.idPersonalSuppliers,phoneSuppliers.value=l.phoneSuppliers,adress.value=l.adress,mood="update",nameSuppliers.focus(),scroll({top:0,behavior:"smooth"}),document.querySelector(".createSuppliers").innerHTML="تحديث البيانات",tmp=e}}function deletSuppliers(e){if("عبدالمعز"==userName.innerHTML)document.querySelector(".alarm").style.display="block",tmpIdDelete=e;else for(let t=0;t<users.length;t++)userName.innerHTML!=users[t].user||"it"!=users[t].job&&"مدير"!=users[t].job||(document.querySelector(".alarm").style.display="block",tmpIdDelete=e)}function checkPass(){ipcRenderer.send("delete-suppliers",tmpIdDelete),window.location.reload(),showDetailsSuppliers()}function exitePass(){window.location.reload()}createSuppliers.addEventListener("click",(e=>{""!=nameSuppliers.value&&(newCustomer={user:userName.innerHTML,date:dateNow,nameSuppliers:nameSuppliers.value,idPersonalSuppliers:idPersonalSuppliers.value,phoneSuppliers:phoneSuppliers.value,adress:adress.value,barcode:"",title:"",count:"",paidPrice:"",remainPrice:"",priceBuy:"",priceSaleAll:"",priceSale:""},"create"==mood?(ipcRenderer.send("myCustomer",newCustomer),window.location.reload()):"update"==mood&&(ipcRenderer.send("update-customer",{...newCustomer,tmp:tmp}),window.location.reload())),showDetailsSuppliers()}));let totalPriceSuppliers=0,totalPaidSuppliers=0,totalRemainSuppliers=0;function showDetailsSuppliers(){tableSuppliers="",ipcRenderer.send("get-Customer","bing"),ipcRenderer.on("get-Customer",((e,t)=>{const l=JSON.parse(t);suppliers.push(l),tableSuppliers="",l.map((e=>{tableSuppliers+=`\n            <tr>\n                <td>${e.mySuppliers.date}</td>\n                <td>${e.mySuppliers.user}</td>\n                <td>${e.mySuppliers.nameSuppliers}</td>\n                <td>${e.mySuppliers.idPersonalSuppliers}</td>\n                <td>${e.mySuppliers.phoneSuppliers}</td>\n                <td>${e.mySuppliers.adress}</td>\n                <td><button omySuppliersnclick="updateSuppliers('${e._id}');">تعديل</button></td>\n                <td><button onclick="deletSuppliers('${e._id}');">حذف</button></td>\n\n            </tr>\n            `})),document.querySelector(".tbodySuppliers").innerHTML=tableSuppliers,ipcRenderer.send("get-invoiceSup","bing"),ipcRenderer.on("get-invoiceSup",((e,t)=>{const l=JSON.parse(t);supplaierInvoice.push(l)}))}))}showDetailsSuppliers();let mydataPro=[];function getPurchases(){ipcRenderer.send("get-Data","bing"),ipcRenderer.on("get-Data",((e,t)=>{const l=JSON.parse(t);mydataPro.push(l)}))}getPurchases();let tableDetailsSuppliers,supplaierInvoice=[];function getSuplaierInoice(){ipcRenderer.send("get-invoiceSup","bing"),ipcRenderer.on("get-invoiceSup",((e,t)=>{const l=JSON.parse(t);supplaierInvoice.push(l)}))}function detailsSuppliers(e){document.querySelector(".tableAllSuppliers").style.display="none",document.querySelector(".detailsSuppliers").style.display="block",showDetailsSuppliers(),getPurchases(),tableDetailsSuppliers="";for(let t=0;t<suppliers[suppliers.length-1].length;t++)if(e==suppliers[suppliers.length-1][t]._id)for(let e=0;e<mydataPro[mydataPro.length-1].length;e++){let l=mydataPro[mydataPro.length-1];l[e].myItems.nameSuplaier==suppliers[suppliers.length-1][t].mySuppliers.nameSuppliers&&(totalPriceSuppliers+=+l[e].myItems.count*+l[e].myItems.priceBuy,totalPaidSuppliers+=+l[e].myItems.paidPrice,totalRemainSuppliers=+totalPriceSuppliers-+totalPaidSuppliers,tableDetailsSuppliers+=`\n                    <tr>\n                        <td>${l[e].myItems.date}</td>\n                        <td>${l[e].myItems.nameSuplaier}</td>\n                        <td>${l[e].myItems.title}</td>\n                        <td>${+l[e].myItems.count*+l[e].myItems.priceBuy}</td>\n                        <td>${l[e].myItems.paidPrice}</td>\n                        <td>${l[e].myItems.remainPrice}</td>\n                        \n                    </tr>\n                    `)}tableDetailsSuppliers+=`\n        <tr>\n            <td colspan='3'>الاجمالي</td>\n            <td>${totalPriceSuppliers}</td>\n            <td>${totalPaidSuppliers}</td>\n            <td class='remainMakeUp'>${totalRemainSuppliers}</td>\n            <td colspan='3'></td>\n        </tr>\n            `,document.querySelector(".tbodyDetailsSuppliers").innerHTML=tableDetailsSuppliers,totalPriceSuppliers=0,totalPaidSuppliers=0,totalRemainSuppliers=0}function returnBack(){document.querySelector(".tableAllSuppliers").style.display="block",document.querySelector(".detailsSuppliers").style.display="none"}function colorRemainSuppliers(){let e=document.querySelectorAll(".remainSuppliers");for(let t=0;t<e.length;t++)e[t].innerHTML<0?e[t].style.color="red":e[t].innerHTML>0&&(e[t].style.color="green")}function printPage(){document.querySelector(".addSuppliers").style.display="none",document.querySelector(".searchSuppliers").style.display="none",document.querySelector("aside").style.display="none",document.querySelector("header").style.display="none",document.querySelector(".content").style.width="100%",window.print(),window.location.reload()}getSuplaierInoice(),colorRemainSuppliers(),document.querySelector(".viewSearchSuppliers").onclick=function(){document.querySelector(".addSuppliers").style.display="none",document.querySelector(".searchSuppliers").style.display="block"},document.querySelector(".viewAddSuppliers").onclick=function(){document.querySelector(".addSuppliers").style.display="block",document.querySelector(".searchSuppliers").style.display="none"};let wordSearchSuppliers=document.querySelector("#wordSearchSuppliers");function searchSuppliers(e){if(document.querySelector(".tableAllSuppliers").style.display="none",document.querySelector(".detailsSuppliers").style.display="block",showDetailsSuppliers(),getPurchases(),""!=e){for(let t=0;t<suppliers[suppliers.length-1].length;t++)if(suppliers[suppliers.length-1][t].mySuppliers.nameSuppliers.includes(e)){tableDetailsSuppliers="";for(let e=0;e<mydataPro[mydataPro.length-1].length;e++){let l=mydataPro[mydataPro.length-1];l[e].myItems.nameSuplaier==suppliers[suppliers.length-1][t].mySuppliers.nameSuppliers&&(totalPriceSuppliers+=+l[e].myItems.count*+l[e].myItems.priceBuy,totalPaidSuppliers+=+l[e].myItems.paidPrice,totalRemainSuppliers=+totalPriceSuppliers-+totalPaidSuppliers,tableDetailsSuppliers+=`\n                        <tr>\n                            <td>${l[e].myItems.date}</td>\n                            <td>${l[e].myItems.nameSuplaier}</td>\n                            <td>${l[e].myItems.title}</td>\n                            <td>${+l[e].myItems.count*+l[e].myItems.priceBuy}</td>\n                            <td>${l[e].myItems.paidPrice}</td>\n                            <td>${l[e].myItems.remainPrice}</td>\n                            \n                        </tr>\n                        `)}}tableDetailsSuppliers+=`\n            <tr>\n                <td colspan='3'>الاجمالي</td>\n                <td>${totalPriceSuppliers}</td>\n                <td>${totalPaidSuppliers}</td>\n                <td class='remainMakeUp'>${totalRemainSuppliers}</td>\n                <td colspan='3'></td>\n            </tr>\n                `,document.querySelector(".tbodyDetailsSuppliers").innerHTML=tableDetailsSuppliers,totalPriceSuppliers=0,totalPaidSuppliers=0,totalRemainSuppliers=0}else tableDetailsSuppliers=""}function refresh(){window.location.reload()}